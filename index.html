<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Math Workout</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-user-select:none;-moz-user-select:none;user-select:none;}
html{overflow:hidden;touch-action:none;height:100%;}
body{
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;
    gap:3rem;padding:1rem;overflow:hidden;position:fixed;width:100%;top:0;left:0;
    transition: background 0.3s, color 0.3s;
}
body.day{background:#f0f0f0;color:#111;}
body.night{background:#0a0a0a;color:#fff;}
body.correct{transition:background 0.1s ease;}
body.wrong{transition:background 0.1s ease;}
body.correct.day{background:#d4f0d4;}
body.wrong.day{background:#f0d4d4;}
body.correct.night{background:#001a00;}
body.wrong.night{background:#1a0000;}

#controls{
    position:absolute;top:1rem;left:1rem;right:1rem;
    display:flex;flex-wrap:wrap;justify-content:center;gap:0.5rem;
    opacity:0.15;transition:opacity 0.3s;
}
#controls:hover{opacity:0.8;}
.btn{
    background:none;border:1px solid #333;color:inherit;padding:0.5rem 0.8rem;
    border-radius:6px;font-size:1rem;cursor:pointer;transition:all 0.2s;
    min-width:80px;text-align:center;
}
.btn:hover,.btn.active{border-color:#555;color:#ffa;}
#mul-digits{
    font-size:1rem;padding:0.4rem 0.6rem;display:none;
    border-radius:6px;background:#111;color:#fff;border:1px solid #333;
}
#question{
    font-size:clamp(1.5rem,8vw,3rem);
    font-weight:300;text-align:center;max-width:90vw;
    opacity:0;transform:translateY(-10px);animation:fadeIn 0.3s ease forwards;cursor:pointer;
}
@keyframes fadeIn{to{opacity:1;transform:translateY(0);}}
#answer{
    background:#111;border:1px solid #333;color:#fff;
    font-size:clamp(1.2rem,6vw,2rem);padding:1rem 1.5rem;
    text-align:center;width:90vw;max-width:350px;border-radius:6px;
    outline:none;-webkit-appearance:none;-moz-appearance:textfield;user-select:text;
}
#answer.correct{border-color:#3a3;}
#answer.wrong{border-color:#a33;animation:shake 0.2s ease;}
@keyframes shake{0%,100%{transform:translateX(0);}50%{transform:translateX(-3px);}}
#streak{position:absolute;bottom:1.5rem;font-size:1rem;font-weight:300;}
#streak.active{color:#ffa;}
#streak.fire{color:#fa5;animation:pulse 1s ease infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.7;}}
.hint{position:absolute;bottom:0.5rem;right:1rem;font-size:0.8rem;color:#888;}
@media screen and (max-width:500px){
    #controls{gap:0.3rem;}
    .btn{font-size:1rem;min-width:70px;}
    #question{font-size:clamp(1.2rem,8vw,2.5rem);}
    #answer{font-size:clamp(1rem,5vw,1.8rem);}
}
</style>
</head>
<body>

<div id="controls">
    <button class="btn active" data-mode="basic">Basic</button>
    <button class="btn" data-mode="mul">Multiplication</button>
    <button class="btn" data-mode="mental">Mental</button>
    <select id="mul-digits">
        <option value="2">2d</option>
        <option value="3" selected>3d</option>
        <option value="4">4d</option>
    </select>
</div>

<div id="question" title="Tap to skip"></div>
<input type="text" id="answer" autocomplete="off">
<div id="streak">0</div>
<div class="hint">Typing auto-checks. Tap question to skip.</div>

<script>
let currentMode='basic', streak=0, correctAnswer, isNumericAnswer=true, mulDigits=3;

// Set day/night theme
function updateTheme(){
    const hour=new Date().getHours();
    document.body.classList.remove('day','night');
    document.body.classList.add(hour>=6 && hour<19?'day':'night');
}
updateTheme();

const modes={
    basic:()=>{ 
        const ops=['+','−','÷'], op=ops[Math.floor(Math.random()*ops.length)];
        const a=Math.floor(Math.random()*90)+10, b=Math.floor(Math.random()*90)+10;
        let question, answer;
        switch(op){
            case '+': question=`${a} + ${b}`; answer=a+b; break;
            case '−': const [x,y]=a>b?[a,b]:[b,a]; question=`${x} − ${y}`; answer=x-y; break;
            case '÷': const c=Math.floor(Math.random()*9)+1; const d=c*(Math.floor(Math.random()*9)+1); question=`${d} ÷ ${c}`; answer=d/c; break;
        }
        return {question, answer, numeric:true};
    },
    mul:()=>{ 
        const min=Math.pow(10,mulDigits-1), max=Math.pow(10,mulDigits)-1;
        const a=Math.floor(Math.random()*(max-min+1))+min;
        const b=Math.floor(Math.random()*(max-min+1))+min;
        return {question:`${a} × ${b}`, answer:a*b, numeric:true};
    },
    mental:()=>{ const n=Math.floor(Math.random()*25)+1; return {question:`${n}²`, answer:n*n, numeric:true}; }
};

function generateQuestion(){
    const res=modes[currentMode]();
    document.getElementById('question').textContent=res.question;
    correctAnswer=res.answer; isNumericAnswer=res.numeric;
    const q=document.getElementById('question'); q.style.animation='none'; q.offsetHeight; q.style.animation=null;
}

function checkAnswer(val){ 
    if(isNumericAnswer) return Math.abs(parseFloat(val)-parseFloat(correctAnswer))<0.01;
    return val.toLowerCase().trim()===correctAnswer.toString().toLowerCase();
}

function updateStreak(correct){ 
    streak=correct?streak+1:0; 
    const el=document.getElementById('streak'); 
    el.textContent=streak; 
    el.className=streak>10?'fire':streak>0?'active':'';
}

function flashResult(correct){ 
    document.body.classList.add(correct?'correct':'wrong'); 
    setTimeout(()=>document.body.classList.remove('correct','wrong'),150); 
}

// Input instant validation
const answerInput=document.getElementById('answer');
answerInput.addEventListener('input',function(){
    const val=this.value.trim();
    if(val==='') return;
    if(isNumericAnswer && val.length < correctAnswer.toString().length) return;
    if(checkAnswer(val)){
        flashResult(true); updateStreak(true); this.value=''; generateQuestion();
    } else {
        flashResult(false); updateStreak(false); this.value='';
    }
});

// Tap question to skip
document.getElementById('question').addEventListener('click',()=>{
    generateQuestion();
});

// Mode buttons
document.querySelectorAll('[data-mode]').forEach(btn=>{
    btn.addEventListener('click',function(){
        document.querySelectorAll('[data-mode]').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        currentMode=this.dataset.mode;
        document.getElementById('mul-digits').style.display=currentMode==='mul'?'inline-block':'none';
        streak=0; updateStreak(false); generateQuestion(); answerInput.focus();
    });
});

// Multiplication digits selector
document.getElementById('mul-digits').addEventListener('change',function(){ mulDigits=parseInt(this.value); generateQuestion(); answerInput.focus(); });

// Mobile optimizations
document.addEventListener('touchmove', e=>e.preventDefault(),{passive:false});
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{ const now=Date.now(); if(now-lastTouchEnd<=300) e.preventDefault(); lastTouchEnd=now; }, false);
answerInput.addEventListener('blur', e=>{ if(!e.relatedTarget || !e.relatedTarget.classList.contains('btn')) setTimeout(()=>answerInput.focus(),10); });

// Initialize
generateQuestion();
answerInput.focus();
</script>

</body>
</html>
