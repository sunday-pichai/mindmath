<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Math Workout</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        
        html {
            overflow: hidden;
            touch-action: none;
            height: 100%;
        }

        body {
            background: #0a0a0a;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 3rem;
            padding: 1rem;
            overflow: hidden;
            position: fixed;
            width: 100%;
            top: 0;
            left: 0;
        }

        body.correct {
            background: #001a00;
            transition: background 0.1s ease;
        }

        body.wrong {
            background: #1a0000;
            transition: background 0.1s ease;
        }

        #controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            opacity: 0.15;
            transition: opacity 0.3s;
            display: flex;
            gap: 0.5rem;
        }

        #controls:hover {
            opacity: 0.8;
        }

        .btn {
            background: none;
            border: 1px solid #333;
            color: #666;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover, .btn.active {
            border-color: #555;
            color: #888;
        }

        #question {
            font-size: clamp(1.5rem, 6vw, 3rem);
            font-weight: 300;
            letter-spacing: 0.02em;
            text-align: center;
            line-height: 1.3;
            max-width: 90vw;
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeIn 0.3s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        #answer {
            background: #111;
            border: 1px solid #333;
            color: #fff;
            font-size: clamp(1.2rem, 4vw, 2rem);
            padding: 1rem 1.5rem;
            text-align: center;
            width: min(250px, 70vw);
            border-radius: 6px;
            outline: none;
            -webkit-appearance: none;
            -moz-appearance: textfield;
            touch-action: manipulation;
            user-select: text;
        }

        #answer:focus {
            border-color: #444;
        }

        #answer.wrong {
            border-color: #a33;
            animation: shake 0.2s ease;
        }

        #answer.correct {
            border-color: #3a3;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-3px); }
        }

        #streak {
            position: absolute;
            bottom: 1.5rem;
            font-size: 0.9rem;
            color: #333;
            font-weight: 300;
        }

        #streak.active {
            color: #666;
        }

        #streak.fire {
            color: #fa5;
            animation: pulse 1s ease infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .hint {
            position: absolute;
            bottom: 0.5rem;
            right: 1rem;
            font-size: 0.7rem;
            color: #222;
            font-weight: 300;
        }

        #answer::-webkit-outer-spin-button,
        #answer::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            #answer {
                font-size: max(16px, clamp(1.2rem, 4vw, 2rem));
            }
        }
    </style>
</head>
<body>
    <div id="controls">
        <button class="btn active" data-mode="basic">basic</button>
        <button class="btn" data-mode="mental">mental</button>
        <button class="btn" data-mode="algebra">algebra</button>
        <button class="btn" data-mode="calculus">calculus</button>
        <button class="btn" data-mode="proofs">proofs</button>
        <button class="btn" data-mode="speed">speed</button>
        <select class="btn" id="digits" style="display:none;">
            <option value="2">2d</option>
            <option value="3" selected>3d</option>
            <option value="4">4d</option>
        </select>
    </div>

    <div id="question"></div>
    <input type="text" id="answer" autocomplete="off">
    
    <div id="streak">0</div>
    <div class="hint">enter to skip</div>

    <script>
        let currentMode = 'basic';
        let streak = 0;
        let correctAnswer;
        let isNumericAnswer = true;
        let digits = 3;
        let speedModeActive = false;
        let speedTimer = null;
        let speedTimeLeft = 30;

        const modes = {
            basic: () => {
                const ops = ['×', '+', '−', '÷'];
                const op = ops[Math.floor(Math.random() * ops.length)];
                const min = Math.pow(10, digits - 1);
                const max = Math.pow(10, digits) - 1;
                const a = Math.floor(Math.random() * (max - min + 1)) + min;
                const b = Math.floor(Math.random() * (max - min + 1)) + min;
                
                let question, answer;
                switch(op) {
                    case '×': question = `${a} × ${b}`; answer = a * b; break;
                    case '+': question = `${a} + ${b}`; answer = a + b; break;
                    case '−': 
                        const [x, y] = a > b ? [a, b] : [b, a];
                        question = `${x} − ${y}`; answer = x - y; break;
                    case '÷':
                        const c = Math.floor(Math.random() * 99) + 1;
                        const d = c * (Math.floor(Math.random() * 50) + 1);
                        question = `${d} ÷ ${c}`; answer = d / c; break;
                }
                return { question, answer, numeric: true };
            },

            mental: () => {
                const types = [
                    () => {
                        const n = Math.floor(Math.random() * 25) + 1;
                        return { question: `${n}²`, answer: n * n, numeric: true };
                    },
                    () => {
                        const n = Math.floor(Math.random() * 12) + 2;
                        return { question: `${n}³`, answer: n ** 3, numeric: true };
                    },
                    () => {
                        const base = [2, 3, 5, 7, 11, 13][Math.floor(Math.random() * 6)];
                        const exp = Math.floor(Math.random() * 5) + 2;
                        return { question: `${base}^${exp}`, answer: base ** exp, numeric: true };
                    },
                    () => {
                        const squares = [49, 64, 81, 100, 121, 144, 169, 196, 225, 256, 289, 324, 361, 400, 441, 484, 529, 576, 625];
                        const n = squares[Math.floor(Math.random() * squares.length)];
                        return { question: `√${n}`, answer: Math.sqrt(n), numeric: true };
                    },
                    () => {
                        const n = Math.floor(Math.random() * 20) + 1;
                        return { question: `${n}!`, answer: Array.from({length: n}, (_, i) => i + 1).reduce((a, b) => a * b, 1), numeric: true };
                    }
                ];
                return types[Math.floor(Math.random() * types.length)]();
            },

            speed: () => {
                const a = Math.floor(Math.random() * 20) + 1;
                const b = Math.floor(Math.random() * 20) + 1;
                const ops = ['×', '+'];
                const op = ops[Math.floor(Math.random() * ops.length)];
                const answer = op === '×' ? a * b : a + b;
                return { question: `${a} ${op} ${b}`, answer, numeric: true };
            },

            algebra: () => {
                const types = [
                    () => {
                        const a = Math.floor(Math.random() * 8) + 2;
                        const b = Math.floor(Math.random() * 20) + 1;
                        const c = a * Math.floor(Math.random() * 15) + b;
                        return { question: `${a}x + ${b} = ${c}`, answer: (c - b) / a, numeric: true };
                    },
                    () => {
                        const r1 = Math.floor(Math.random() * 6) + 1;
                        const r2 = Math.floor(Math.random() * 6) + 1;
                        const b = -(r1 + r2), c = r1 * r2;
                        return { question: `x² ${b >= 0 ? '+' : ''}${b}x ${c >= 0 ? '+' : ''}${c} = 0 (smaller root)`, answer: Math.min(r1, r2), numeric: true };
                    },
                    () => {
                        const base = [4, 8, 16, 32, 64, 125, 243][Math.floor(Math.random() * 7)];
                        return { question: `log₂(${base}) = ?`, answer: Math.log2(base), numeric: true };
                    },
                    () => {
                        const a = Math.floor(Math.random() * 5) + 1;
                        const n = Math.floor(Math.random() * 4) + 2;
                        return { question: `Expand: (x + ${a})²`, answer: `x^2 + ${2*a}x + ${a*a}`, numeric: false };
                    }
                ];
                return types[Math.floor(Math.random() * types.length)]();
            },

            calculus: () => {
                const types = [
                    () => {
                        const n = Math.floor(Math.random() * 6) + 2;
                        const c = Math.floor(Math.random() * 8) + 1;
                        return { question: `d/dx [${c}x^${n}]`, answer: `${c * n}x^${n - 1}`, numeric: false };
                    },
                    () => {
                        const n = Math.floor(Math.random() * 5) + 1;
                        return { question: `∫ x^${n} dx`, answer: `x^${n + 1}/${n + 1} + C`, numeric: false };
                    },
                    () => {
                        const a = Math.floor(Math.random() * 9) + 1;
                        return { question: `lim(x→∞) ${a}/x`, answer: '0', numeric: false };
                    },
                    () => {
                        const n = Math.floor(Math.random() * 4) + 1;
                        const result = 1 / (n + 1);
                        return { question: `∫₀¹ x^${n} dx`, answer: result.toString().includes('.') ? `1/${n + 1}` : result.toString(), numeric: false };
                    },
                    () => {
                        return { question: `d/dx [sin x]`, answer: 'cos x', numeric: false };
                    },
                    () => {
                        return { question: `d/dx [ln x]`, answer: '1/x', numeric: false };
                    },
                    () => {
                        const a = Math.floor(Math.random() * 5) + 1;
                        return { question: `∫ 1/x dx`, answer: 'ln|x| + C', numeric: false };
                    }
                ];
                return types[Math.floor(Math.random() * types.length)]();
            },

            proofs: () => {
                const proofs = [
                    // Proof techniques
                    { question: 'If n is even, then n² is even. What proof technique?', answer: 'direct', numeric: false },
                    { question: 'Prove √2 is irrational. What technique?', answer: 'contradiction', numeric: false },
                    { question: 'For all n ∈ ℕ: 1+2+...+n = n(n+1)/2. What technique?', answer: 'induction', numeric: false },
                    { question: 'To prove "For all x, P(x)", show P(k) → P(k+1). What technique?', answer: 'induction', numeric: false },
                    { question: 'To prove P → Q, assume ¬Q and derive ¬P. What technique?', answer: 'contrapositive', numeric: false },
                    { question: 'To prove P, assume ¬P and derive contradiction. What technique?', answer: 'contradiction', numeric: false },
                    
                    // Set theory
                    { question: 'What is ∅ ∪ A?', answer: 'A', numeric: false },
                    { question: 'What is A ∩ A^c?', answer: 'empty set', numeric: false },
                    { question: 'What is A ∪ A^c?', answer: 'universal set', numeric: false },
                    { question: 'What is A ∩ A?', answer: 'A', numeric: false },
                    { question: 'What is A \\ A?', answer: 'empty set', numeric: false },
                    { question: 'If A ⊆ B and B ⊆ A, then A = ?', answer: 'B', numeric: false },
                    { question: '|A ∪ B| = |A| + |B| - ?', answer: '|A ∩ B|', numeric: false },
                    
                    // Logic
                    { question: 'Contrapositive of "If P then Q"?', answer: 'if not Q then not P', numeric: false },
                    { question: 'Converse of "If P then Q"?', answer: 'if Q then P', numeric: false },
                    { question: 'Negation of "∀x P(x)"?', answer: '∃x ¬P(x)', numeric: false },
                    { question: 'Negation of "∃x P(x)"?', answer: '∀x ¬P(x)', numeric: false },
                    { question: 'P ∧ (Q ∨ R) = ?', answer: '(P ∧ Q) ∨ (P ∧ R)', numeric: false },
                    { question: 'P ∨ (Q ∧ R) = ?', answer: '(P ∨ Q) ∧ (P ∨ R)', numeric: false },
                    { question: '¬(P ∧ Q) = ?', answer: '¬P ∨ ¬Q', numeric: false },
                    { question: '¬(P ∨ Q) = ?', answer: '¬P ∧ ¬Q', numeric: false },
                    
                    // Analysis theorems
                    { question: 'If f is continuous on [a,b], then f attains its maximum. What theorem?', answer: 'extreme value theorem', numeric: false },
                    { question: 'Every bounded sequence has a convergent subsequence. What theorem?', answer: 'bolzano weierstrass', numeric: false },
                    { question: 'If f is continuous on [a,b] and f(a)f(b) < 0, then ∃c: f(c) = 0. What theorem?', answer: 'intermediate value theorem', numeric: false },
                    { question: 'If f is differentiable on (a,b) and continuous on [a,b], then ∃c: f\'(c) = (f(b)-f(a))/(b-a). What theorem?', answer: 'mean value theorem', numeric: false },
                    { question: 'Every Cauchy sequence in ℝ converges. What property?', answer: 'completeness', numeric: false },
                    
                    // Number theory
                    { question: 'gcd(a,b) = gcd(b, a mod b). What algorithm?', answer: 'euclidean algorithm', numeric: false },
                    { question: 'If gcd(a,n) = 1, then a^φ(n) ≡ 1 (mod n). What theorem?', answer: 'euler theorem', numeric: false },
                    { question: 'If p is prime and a^(p-1) ≡ 1 (mod p). What theorem?', answer: 'fermat little theorem', numeric: false },
                    { question: 'There are infinitely many primes. Who proved this?', answer: 'euclid', numeric: false },
                    
                    // Group theory
                    { question: 'In a group, what is the identity element denoted as?', answer: 'e', numeric: false },
                    { question: 'A group where ab = ba for all a,b is called?', answer: 'abelian', numeric: false },
                    { question: 'The set of integers under addition forms a?', answer: 'group', numeric: false },
                    { question: 'Order of element a is smallest positive n such that a^n = ?', answer: 'e', numeric: false }
                ];
                return proofs[Math.floor(Math.random() * proofs.length)];
            }
        };

        function generateQuestion() {
            const result = modes[currentMode]();
            document.getElementById('question').textContent = result.question;
            correctAnswer = result.answer;
            isNumericAnswer = result.numeric;
            
            // Reset animation
            const q = document.getElementById('question');
            q.style.animation = 'none';
            q.offsetHeight; // Trigger reflow
            q.style.animation = null;
        }

        function checkAnswer(userInput) {
            if (isNumericAnswer) {
                const userNum = parseFloat(userInput);
                const correctNum = parseFloat(correctAnswer);
                return Math.abs(userNum - correctNum) < 0.01;
            } else {
                return userInput.toLowerCase().trim() === correctAnswer.toLowerCase();
            }
        }

        function updateStreak(correct) {
            streak = correct ? streak + 1 : 0;
            const streakEl = document.getElementById('streak');
            streakEl.textContent = streak;
            streakEl.className = streak > 10 ? 'fire' : streak > 0 ? 'active' : '';
        }

        function flashResult(correct) {
            document.body.classList.add(correct ? 'correct' : 'wrong');
            setTimeout(() => {
                document.body.classList.remove('correct', 'wrong');
            }, 150);
        }

        // Event listeners
        document.getElementById('answer').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const userAnswer = this.value.trim();
                
                if (userAnswer === '') {
                    updateStreak(false);
                    this.classList.remove('wrong', 'correct');
                    generateQuestion();
                    return;
                }

                const correct = checkAnswer(userAnswer);
                
                this.classList.add(correct ? 'correct' : 'wrong');
                updateStreak(correct);
                flashResult(correct);
                
                setTimeout(() => {
                    this.value = '';
                    this.classList.remove('wrong', 'correct');
                    generateQuestion();
                }, correct ? 200 : 500);
            }
        });

        // Mode switching
        document.querySelectorAll('[data-mode]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentMode = this.dataset.mode;
                
                // Show/hide digits selector
                const digitsSelect = document.getElementById('digits');
                if (currentMode === 'basic') {
                    digitsSelect.style.display = 'inline-block';
                } else {
                    digitsSelect.style.display = 'none';
                }
                
                // Handle speed mode
                if (currentMode === 'speed') {
                    startSpeedMode();
                } else {
                    stopSpeedMode();
                }
                
                document.getElementById('answer').value = '';
                streak = 0;
                updateStreak(false);
                generateQuestion();
                document.getElementById('answer').focus();
            });
        });

        // Digits selector
        document.getElementById('digits').addEventListener('change', function() {
            digits = parseInt(this.value);
            generateQuestion();
            document.getElementById('answer').focus();
        });

        function startSpeedMode() {
            speedModeActive = true;
            speedTimeLeft = 30;
            updateSpeedDisplay();
            speedTimer = setInterval(() => {
                speedTimeLeft--;
                updateSpeedDisplay();
                if (speedTimeLeft <= 0) {
                    endSpeedMode();
                }
            }, 1000);
        }

        function stopSpeedMode() {
            speedModeActive = false;
            if (speedTimer) {
                clearInterval(speedTimer);
                speedTimer = null;
            }
            document.getElementById('streak').textContent = streak;
        }

        function endSpeedMode() {
            stopSpeedMode();
            const finalScore = streak;
            document.getElementById('question').textContent = `Speed Round Complete! Score: ${finalScore}`;
            setTimeout(() => {
                generateQuestion();
            }, 3000);
        }

        function updateSpeedDisplay() {
            if (speedModeActive) {
                document.getElementById('streak').textContent = `${streak} | ${speedTimeLeft}s`;
            }
        }

        // Mobile optimizations
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
        
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) e.preventDefault();
            lastTouchEnd = now;
        }, false);

        document.getElementById('answer').addEventListener('blur', function(e) {
            if (!e.relatedTarget || !e.relatedTarget.classList.contains('btn')) {
                setTimeout(() => this.focus(), 10);
            }
        });

        // Initialize
        generateQuestion();
        document.getElementById('answer').focus();
    </script>
</body>
</html>