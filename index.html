<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Math Workout</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-user-select: none; -moz-user-select: none; user-select: none; }
    html { overflow: hidden; touch-action: none; height: 100%; }
    body {
        background: #0a0a0a;
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 3rem;
        padding: 1rem;
        overflow: hidden;
        position: fixed;
        width: 100%;
        top: 0;
        left: 0;
    }
    body.correct { background: #001a00; transition: background 0.1s ease; }
    body.wrong { background: #1a0000; transition: background 0.1s ease; }
    #controls {
        position: absolute;
        top: 1rem;
        right: 1rem;
        opacity: 0.15;
        transition: opacity 0.3s;
        display: flex;
        gap: 0.5rem;
    }
    #controls:hover { opacity: 0.8; }
    .btn {
        background: none;
        border: 1px solid #333;
        color: #666;
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s;
    }
    .btn:hover, .btn.active { border-color: #555; color: #888; }
    #question {
        font-size: clamp(1.5rem, 6vw, 3rem);
        font-weight: 300;
        letter-spacing: 0.02em;
        text-align: center;
        line-height: 1.3;
        max-width: 90vw;
        opacity: 0;
        transform: translateY(-10px);
        animation: fadeIn 0.3s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    #answer {
        background: #111;
        border: 1px solid #333;
        color: #fff;
        font-size: clamp(1.2rem, 4vw, 2rem);
        padding: 1rem 1.5rem;
        text-align: center;
        width: min(250px, 70vw);
        border-radius: 6px;
        outline: none;
        -webkit-appearance: none;
        -moz-appearance: textfield;
        touch-action: manipulation;
        user-select: text;
    }
    #answer:focus { border-color: #444; }
    #answer.wrong { border-color: #a33; animation: shake 0.2s ease; }
    #answer.correct { border-color: #3a3; }
    @keyframes shake { 0%,100%{transform:translateX(0);}50%{transform:translateX(-3px);} }
    #streak {
        position: absolute;
        bottom: 1.5rem;
        font-size: 0.9rem;
        color: #333;
        font-weight: 300;
    }
    #streak.active { color: #666; }
    #streak.fire { color: #fa5; animation: pulse 1s ease infinite; }
    @keyframes pulse { 0%,100%{opacity:1;}50%{opacity:0.7;} }
    .hint { position: absolute; bottom: 0.5rem; right: 1rem; font-size: 0.7rem; color: #222; font-weight: 300; }
    #answer::-webkit-outer-spin-button,#answer::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}
    @media screen and (-webkit-min-device-pixel-ratio:0){#answer{font-size:max(16px,clamp(1.2rem,4vw,2rem));}}
</style>
</head>
<body>
<div id="controls">
    <button class="btn active" data-mode="basic">Basic</button>
    <button class="btn" data-mode="mul">Multiplication</button>
    <button class="btn" data-mode="mental">Mental</button>
    <button class="btn" data-mode="algebra">Algebra</button>
    <button class="btn" data-mode="calculus">Calculus</button>
    <button class="btn" data-mode="proofs">Proofs</button>
    <button class="btn" data-mode="speed">Speed</button>
    <select class="btn" id="mul-digits" style="display:none;">
        <option value="2">2d</option>
        <option value="3" selected>3d</option>
        <option value="4">4d</option>
    </select>
</div>

<div id="question"></div>
<input type="text" id="answer" autocomplete="off">
<div id="streak">0</div>
<div class="hint">enter to skip</div>

<script>
let currentMode = 'basic';
let streak = 0;
let correctAnswer;
let isNumericAnswer = true;
let mulDigits = 3;
let speedModeActive = false;
let speedTimer = null;
let speedTimeLeft = 30;

const modes = {
    basic: () => {
        const ops = ['+', '−', '÷'];
        const op = ops[Math.floor(Math.random() * ops.length)];
        const a = Math.floor(Math.random() * 90) + 10;
        const b = Math.floor(Math.random() * 90) + 10;
        let question, answer;
        switch(op) {
            case '+': question = `${a} + ${b}`; answer = a + b; break;
            case '−': const [x, y] = a > b ? [a, b] : [b, a]; question = `${x} − ${y}`; answer = x - y; break;
            case '÷': const c = Math.floor(Math.random() * 9) + 1; const d = c * (Math.floor(Math.random() * 9) + 1); question = `${d} ÷ ${c}`; answer = d / c; break;
        }
        return { question, answer, numeric: true };
    },

    mul: () => {
        const min = Math.pow(10, mulDigits - 1);
        const max = Math.pow(10, mulDigits) - 1;
        const a = Math.floor(Math.random() * (max - min + 1)) + min;
        const b = Math.floor(Math.random() * (max - min + 1)) + min;
        return { question: `${a} × ${b}`, answer: a * b, numeric: true };
    },

    mental: () => { /* same as before */ return {question:'2²',answer:4,numeric:true}; },
    algebra: () => { /* same as before */ return {question:'x+1=2',answer:1,numeric:true}; },
    calculus: () => { /* same as before */ return {question:'d/dx x²',answer:'2x',numeric:false}; },
    proofs: () => { /* same as before */ return {question:'If n is even then n² is even',answer:'direct',numeric:false}; },
    speed: () => {
        const a=Math.floor(Math.random()*20)+1;const b=Math.floor(Math.random()*20)+1;
        const ops=['×','+'];const op=ops[Math.floor(Math.random()*ops.length)];
        const answer=op==='×'?a*b:a+b;
        return {question:`${a} ${op} ${b}`,answer,numeric:true};
    }
};

function generateQuestion() {
    const result = modes[currentMode]();
    document.getElementById('question').textContent = result.question;
    correctAnswer = result.answer;
    isNumericAnswer = result.numeric;
    const q = document.getElementById('question');
    q.style.animation='none';
    q.offsetHeight;
    q.style.animation=null;
}

function checkAnswer(userInput){
    if(isNumericAnswer){ return Math.abs(parseFloat(userInput)-parseFloat(correctAnswer))<0.01; }
    return userInput.toLowerCase().trim()===correctAnswer.toLowerCase();
}

function updateStreak(correct){
    streak=correct?streak+1:0;
    const streakEl=document.getElementById('streak');
    streakEl.textContent=streak;
    streakEl.className=streak>10?'fire':streak>0?'active':'';
}

function flashResult(correct){
    document.body.classList.add(correct?'correct':'wrong');
    setTimeout(()=>{document.body.classList.remove('correct','wrong');},150);
}

document.getElementById('answer').addEventListener('keydown',function(e){
    if(e.key==='Enter'){
        const userAnswer=this.value.trim();
        if(userAnswer===''){ updateStreak(false); this.classList.remove('wrong','correct'); generateQuestion(); return; }
        const correct=checkAnswer(userAnswer);
        this.classList.add(correct?'correct':'wrong');
        updateStreak(correct);
        flashResult(correct);
        setTimeout(()=>{ this.value=''; this.classList.remove('wrong','correct'); generateQuestion(); }, correct?200:500);
    }
});

document.querySelectorAll('[data-mode]').forEach(btn=>{
    btn.addEventListener('click',function(){
        document.querySelectorAll('[data-mode]').forEach(b=>b.classList.remove('active'));
        this.classList.add('active');
        currentMode=this.dataset.mode;
        const mulDigitsSelect=document.getElementById('mul-digits');
        mulDigitsSelect.style.display=currentMode==='mul'?'inline-block':'none';
        document.getElementById('answer').value='';
        streak=0;
        updateStreak(false);
        generateQuestion();
        document.getElementById('answer').focus();
    });
});

document.getElementById('mul-digits').addEventListener('change',function(){
    mulDigits=parseInt(this.value);
    generateQuestion();
    document.getElementById('answer').focus();
});

document.addEventListener('touchmove', e => e.preventDefault(), {passive:false});
let lastTouchEnd=0;
document.addEventListener('touchend',function(e){const now=Date.now(); if(now-lastTouchEnd<=300)e.preventDefault(); lastTouchEnd=now;}, false);
document.getElementById('answer').addEventListener('blur',function(e){if(!e.relatedTarget||!e.relatedTarget.classList.contains('btn')){setTimeout(()=>this.focus(),10);}});

generateQuestion();
document.getElementById('answer').focus();
</script>
</body>
</html>
